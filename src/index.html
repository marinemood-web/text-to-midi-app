<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Text to MIDI</title>
  <script type="module">
    import { Midi } from 'https://cdn.jsdelivr.net/npm/@tonejs/midi@2.0.27/+esm';

    const CHORD_MAP = {
      // –õ–∞—Ç–∏–Ω–∏—Ü–∞ A-Z
      A: ['A3', 'C#4', 'E4', 'G4'],
      B: ['B3', 'D#4', 'F#4', 'G#4'],
      C: ['C4', 'E4', 'G4', 'B4'],
      D: ['D4', 'F#4', 'A4', 'C#5'],
      E: ['E4', 'G#4', 'B4', 'C#5'],
      F: ['F3', 'A3', 'C4', 'E4'],
      G: ['G3', 'B3', 'D4', 'F#4'],
      H: ['B3', 'D#4', 'F#4', 'A4'],
      I: ['A3', 'C#4', 'E4'],
      J: ['C4', 'E4', 'G4', 'A4'],
      K: ['D4', 'F#4', 'A4'],
      L: ['F3', 'A3', 'C4'],
      M: ['G3', 'B3', 'D4', 'A4'],
      N: ['A3', 'C#4', 'E4'],
      O: ['C4', 'E4', 'G#4'],
      P: ['D4', 'F#4', 'A4', 'C5'],
      Q: ['E4', 'G#4', 'B4', 'D5'],
      R: ['F3', 'A3', 'C4', 'G4'],
      S: ['G3', 'B3', 'D4', 'F4'],
      T: ['A3', 'C#4', 'F#4'],
      U: ['Bb3', 'D4', 'F4', 'G4'],
      V: ['C4', 'E4', 'F#4', 'B4'],
      W: ['D4', 'F#4', 'C#5', 'G#4'],
      X: ['E3', 'F4', 'G#4', 'B4'],
      Y: ['F#3', 'G#3', 'B3', 'C#4'],
      Z: ['Gb3', 'A3', 'D4', 'F#4'],

      // –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ (–≤ –º–∏–Ω–æ—Ä–µ)
      –ê: ['A3', 'C4', 'E4'],
      –ë: ['B3', 'D4', 'F4'],
      –í: ['C4', 'Eb4', 'G4'],
      –ì: ['D3', 'F4', 'A4'],
      –î: ['E3', 'G4', 'B4'],
      –ï: ['F3', 'Ab3', 'C4'],
      –ñ: ['G3', 'Bb3', 'Db4', 'F4'],
      –ó: ['Ab3', 'B3', 'Eb4'],
      –ò: ['Bb3', 'Db4', 'F4'],
      –ô: ['C3', 'E3', 'G3', 'B3'],
      –ö: ['D3', 'F3', 'A3'],
      –õ: ['E3', 'G3', 'B3'],
      –ú: ['F#3', 'A3', 'C4'],
      –ù: ['G#3', 'B3', 'D4'],
      –û: ['A#3', 'C#4', 'E4'],
      –ü: ['B3', 'D4', 'F4'],
      –†: ['C#4', 'E4', 'G4'],
      –°: ['D#4', 'F#4', 'A4'],
      –¢: ['F3', 'G#3', 'C4'],
      –£: ['G3', 'A3', 'C4'],
      –§: ['Ab3', 'B3', 'Eb4'],
      –•: ['Bb3', 'Db4', 'F4'],
      –¶: ['C3', 'Eb3', 'G3', 'B3'],
      –ß: ['D3', 'F3', 'G#3'],
      –®: ['E3', 'F#3', 'C4'],
      –©: ['F#3', 'A3', 'C#4', 'E4'],
      –™: ['G#3', 'B3', 'D4', 'F4'],
      –´: ['A#3', 'C#4', 'E4', 'G4'],
      –¨: ['B3', 'D4', 'F#4'],
      –≠: ['C4', 'Eb4', 'F4'],
      –Æ: ['D#3', 'F#3', 'A3'],
      –Ø: ['F#3', 'A3', 'C#4'],

      // –¶–∏—Ñ—Ä—ã
      '0': ['C2'],          // —Ç–∏—à–∏–Ω–∞ / —É–¥–∞—Ä
      '1': ['A3', 'G4', 'Bb4'],
      '2': ['B3', 'D4', 'F4'],
      '3': ['C4', 'Eb4', 'Gb4'],
      '4': ['D4', 'F4', 'A4'],
      '5': ['E4', 'G4', 'B4'],
      '6': ['F#4', 'A4', 'C5'],
      '7': ['G4', 'Bb4', 'Db5'],
      '8': ['Ab4', 'C5', 'Eb5'],
      '9': ['Bb4', 'D5', 'F5'],

      // –°–∏–º–≤–æ–ª—ã
      '.': ['E5'],     // —Ç–æ—á–∫–∞ ‚Äî –≤—ã—Å–æ–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
      ',': ['G4'],     // –∑–∞–ø—è—Ç–∞—è ‚Äî —É–¥–µ—Ä–∂–∞–Ω–∏–µ
      ' ': [],         // –ø–∞—É–∑–∞
      '\n': []         // –ø–µ—Ä–µ–Ω–æ—Å ‚Äî –ø–∞—É–∑–∞
    };

    window.generateMIDI = async function () {
      const input = document.getElementById("text").value;
      const midi = new Midi();
      const track = midi.addTrack();
      let time = 0;

      for (const char of input) {
        const normalized = char.toUpperCase();
        const chord = CHORD_MAP[normalized];

        if (chord) {
          for (const note of chord) {
            track.addNote({ name: note, time, duration: 1 });
          }
          time += 1;
        } else if (normalized === ' ' || normalized === '\n') {
          time += 1; // –ø–∞—É–∑–∞
        }
      }

      const bytes = midi.toArray();
      const blob = new Blob([new Uint8Array(bytes)], { type: "audio/midi" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "output.mid";
      a.click();
      URL.revokeObjectURL(a.href);
    };
  </script>
</head>
<body style="font-family:sans-serif;padding:2em">
  <h1>üéπ Text to MIDI</h1>
  <textarea id="text" rows="8" cols="50" placeholder="–ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç –∏–ª–∏ —à—ë–ø–æ—Ç..."></textarea><br><br>
  <button onclick="generateMIDI()">üéº –°–∫–∞—á–∞—Ç—å MIDI</button>
</body>
</html>
